{"version":3,"sources":["board.js"],"names":["NeighborType","Above","offset","AboveLeft","AboveRight","Below","BelowLeft","BelowRight","KnightAboveLeft","KnightAboveRight","KnightBelowLeft","KnightBelowRight","KnightLeftAbove","KnightLeftBelow","KnightRightAbove","KnightRightBelow","Left","Right","Board","squares","fen","acc","cur","idx","outerIdx","push","row","i","length","square","file","rank","piece","transform","side","name","notation","isNaN","Number","join","sq","n","fIndex","f","r","charAt","list","src","dest","getSquare","simulate","move","algebraic","capturedPiece","castle","enPassant","postSquare","prevSquare","p","undo","b","m","undone","Error","moveCount","emit","type","PieceType","King","Pawn","lastMovedPiece","Math","floor","Square","create","Piece","createRook","SideType","White","Black","createKnight","createBishop","createQueen","createKing","createPawn","pieces","arg","method","B","k","K","N","P","q","Q","R","split","board","lines","line","arr","EventEmitter"],"mappings":"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","sourcesContent":["/**\n\tThe Board is the representation of the current position of the pieces on\n\tthe squares it contains.\n*/\nimport { Piece, PieceType, SideType } from './piece';\nimport { EventEmitter } from 'events';\nimport { Square } from './square';\n\n// types\nexport var NeighborType = {\n\tAbove : { offset : 8 },\n\tAboveLeft : { offset : 7 },\n\tAboveRight : { offset : 9 },\n\tBelow : { offset : -8 },\n\tBelowLeft : { offset : -9 },\n\tBelowRight : { offset : -7 },\n\tKnightAboveLeft : { offset : 15 },\n\tKnightAboveRight : { offset : 17 },\n\tKnightBelowLeft : { offset : -17 },\n\tKnightBelowRight : { offset : -15 },\n\tKnightLeftAbove : { offset : 6 },\n\tKnightLeftBelow : { offset : -10 },\n\tKnightRightAbove : { offset : 10 },\n\tKnightRightBelow : { offset : -6 },\n\tLeft : { offset : -1 },\n\tRight : { offset : 1 }\n};\n\n// ctor\nexport class Board extends EventEmitter {\n\tconstructor (squares) {\n\t\tsuper();\n\n\t\tthis.squares = squares;\n\t}\n\n\tstatic create () {\n\t\tlet\n\t\t\tb = new Board([]),\n\t\t\tf = 0,\n\t\t\ti = 0,\n\t\t\tr = 0,\n\t\t\tsq = null;\n\n\t\t/* eslint no-magic-numbers:0 */\n\t\tfor (i = 0; i < 64; i++) {\n\t\t\tf = Math.floor(i % 8);\n\t\t\tr = Math.floor(i / 8) + 1;\n\t\t\tsq = Square.create('abcdefgh'[f], r);\n\n\t\t\tb.squares.push(sq);\n\n\t\t\tif (r === 1 || r === 8) { // Named pieces\n\t\t\t\tif (f === 0 || f === 7) { // Rookage\n\t\t\t\t\tsq.piece = Piece.createRook(\n\t\t\t\t\t\tr === 1 ? SideType.White : SideType.Black\n\t\t\t\t\t);\n\t\t\t\t} else if (f === 1 || f === 6) { // Knights\n\t\t\t\t\tsq.piece = Piece.createKnight(\n\t\t\t\t\t\tr === 1 ? SideType.White : SideType.Black\n\t\t\t\t\t);\n\t\t\t\t} else if (f === 2 || f === 5) { // Bish's\n\t\t\t\t\tsq.piece = Piece.createBishop(\n\t\t\t\t\t\tr === 1 ? SideType.White : SideType.Black\n\t\t\t\t\t);\n\t\t\t\t} else if (f === 3) {\n\t\t\t\t\tsq.piece = Piece.createQueen(\n\t\t\t\t\t\tr === 1 ? SideType.White : SideType.Black\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tsq.piece = Piece.createKing(\n\t\t\t\t\t\tr === 1 ? SideType.White : SideType.Black\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else if (r === 2 || r === 7) { // Pawns\n\t\t\t\tsq.piece = Piece.createPawn(\n\t\t\t\t\tr === 2 ? SideType.White : SideType.Black\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\treturn b;\n\t}\n\n\tstatic load (fen) {\n\t\tconst pieces = {\n\t\t\tb: { arg: SideType.Black, method: 'createBishop' },\n\t\t\tB: { arg: SideType.White, method: 'createBishop' },\n\t\t\tk: { arg: SideType.Black, method: 'createKing' },\n\t\t\tK: { arg: SideType.White, method: 'createKing' },\n\t\t\tn: { arg: SideType.Black, method: 'createKnight' },\n\t\t\tN: { arg: SideType.White, method: 'createKnight' },\n\t\t\tp: { arg: SideType.Black, method: 'createPawn' },\n\t\t\tP: { arg: SideType.White, method: 'createPawn' },\n\t\t\tq: { arg: SideType.Black, method: 'createQueen' },\n\t\t\tQ: { arg: SideType.White, method: 'createQueen' },\n\t\t\tr: { arg: SideType.Black, method: 'createRook' },\n\t\t\tR: { arg: SideType.White, method: 'createRook' }\n\t\t};\n\n\t\tconst [board/* , turn, castling, enPassant, halfs, moves */] = fen.split(' ');\n\t\tconst lines = board.split('/')\n\t\t\t.map((line, rank) => {\n\t\t\t\tconst arr = line.split('');\n\t\t\t\tlet file = 0;\n\n\t\t\t\treturn arr.reduce((acc, cur) => {\n\t\t\t\t\tif (!isNaN(Number(cur))) {\n\t\t\t\t\t\tfor (let i = 0; i < Number(cur); i += 1) {\n\t\t\t\t\t\t\tacc.push(Square.create('abcdefgh'[file], 8 - rank));\n\t\t\t\t\t\t\tfile = file < 7 ? file + 1 : 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst square = Square.create('abcdefgh'[file], 8 - rank);\n\t\t\t\t\t\tsquare.piece = Piece[pieces[cur].method](pieces[cur].arg);\n\t\t\t\t\t\tacc.push(square);\n\t\t\t\t\t\tfile = file < 7 ? file + 1 : 0;\n\t\t\t\t\t}\n\t\t\t\t\treturn acc;\n\t\t\t\t}, []);\n\t\t\t});\n\n\t\treturn new Board(lines.reduce((acc, cur) => {\n\t\t\tacc.push(...cur);\n\t\t\treturn acc;\n\t\t}, []));\n\t}\n\n\tgetFen () {\n\t\tconst fen = [];\n\t\tconst squares = this.squares\n\t\t\t.reduce((acc, cur, idx) => {\n\t\t\t\tconst outerIdx = parseInt(idx / 8, 10);\n\t\t\t\tacc[outerIdx] = acc[outerIdx] || [];\n\t\t\t\tacc[outerIdx].push(cur);\n\t\t\t\treturn acc;\n\t\t\t}, [])\n\t\t\t.flatMap((row) => row.reverse())\n\t\t\t.reverse();\n\n\t\tfor (let i = 0; i < squares.length; i += 1) {\n\t\t\tconst square = squares[i];\n\n\t\t\tif (square.file === 'a' && square.rank < 8) {\n\t\t\t\tfen.push('/');\n\t\t\t}\n\n\t\t\tif (square.piece) {\n\t\t\t\tconst transform = `to${square.piece.side.name === 'white' ? 'Upp' : 'Low'}erCase`;\n\t\t\t\tfen.push((square.piece.notation || 'p')[transform]());\n\t\t\t} else {\n\t\t\t\tif (isNaN(Number(fen[fen.length - 1]))) {\n\t\t\t\t\tfen.push(1);\n\t\t\t\t} else {\n\t\t\t\t\tfen[fen.length - 1] += 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn fen.join('');\n\t}\n\n\tgetNeighborSquare (sq, n) {\n\t\tif (sq && n) {\n\t\t\t// validate boundaries of board\n\t\t\tif (sq.file === 'a' && (n === NeighborType.AboveLeft ||\n\t\t\t\t\tn === NeighborType.BelowLeft ||\n\t\t\t\t\tn === NeighborType.Left)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (sq.file === 'h' && (n === NeighborType.AboveRight ||\n\t\t\t\t\tn === NeighborType.BelowRight ||\n\t\t\t\t\tn === NeighborType.Right)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (sq.rank === 1 && (n === NeighborType.Below ||\n\t\t\t\t\tn === NeighborType.BelowLeft ||\n\t\t\t\t\tn === NeighborType.BelowRight)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (sq.rank === 8 && (n === NeighborType.Above ||\n\t\t\t\t\tn === NeighborType.AboveLeft ||\n\t\t\t\t\tn === NeighborType.AboveRight)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// validate file\n\t\t\tlet\n\t\t\t\tfIndex = 'abcdefgh'.indexOf(sq.file),\n\t\t\t\ti = 0;\n\n\t\t\tif (fIndex !== -1 && sq.rank > 0 && sq.rank < 9) {\n\t\t\t\t// find the index\n\t\t\t\ti = 8 * (sq.rank - 1) + fIndex + n.offset;\n\t\t\t\tif (this.squares && this.squares.length > i && i > -1) {\n\t\t\t\t\treturn this.squares[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetSquare (f, r) {\n\t\t// check for shorthand\n\t\tif (typeof f === 'string' && f.length === 2 && !r) {\n\t\t\tr = parseInt(f.charAt(1), 10);\n\t\t\tf = f.charAt(0);\n\t\t}\n\n\t\t// validate file\n\t\tlet\n\t\t\tfIndex = 'abcdefgh'.indexOf(f),\n\t\t\ti = 0;\n\n\t\tif (fIndex !== -1 && r > 0 && r < 9) {\n\t\t\t// Find the index\n\t\t\ti = 8 * (r - 1) + fIndex;\n\t\t\tif (this.squares && this.squares.length > i) {\n\t\t\t\treturn this.squares[i];\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetSquares (side) {\n\t\tconst list = [];\n\n\t\tfor (let i = 0; i < this.squares.length; i++) {\n\t\t\tif (this.squares[i].piece && this.squares[i].piece.side === side) {\n\t\t\t\tlist.push(this.squares[i]);\n\t\t\t}\n\t\t}\n\n\t\treturn list;\n\t}\n\n\tmove (src, dest, n) {\n\t\tif (typeof src === 'string' && src.length === 2) {\n\t\t\tsrc = this.getSquare(src);\n\t\t}\n\n\t\tif (typeof dest === 'string' && dest.length === 2) {\n\t\t\tdest = this.getSquare(dest);\n\t\t}\n\n\t\tlet simulate;\n\n\t\tif (typeof n === 'boolean') {\n\t\t\tsimulate = n;\n\t\t\tn = null;\n\t\t}\n\n\t\tif (src && src.file && src.rank && dest && dest.file && dest.rank) {\n\t\t\tlet\n\t\t\t\tmove = {\n\t\t\t\t\talgebraic : n,\n\t\t\t\t\tcapturedPiece : dest.piece,\n\t\t\t\t\tcastle : false,\n\t\t\t\t\tenPassant : false,\n\t\t\t\t\tpostSquare : dest,\n\t\t\t\t\tprevSquare : src\n\t\t\t\t},\n\t\t\t\tp = src.piece,\n\t\t\t\tsq = null,\n\t\t\t\tundo = (b, m) => {\n\t\t\t\t\treturn () => {\n\t\t\t\t\t\tif (!simulate) {\n\t\t\t\t\t\t\t// ensure no harm can be done if called multiple times\n\t\t\t\t\t\t\tif (m.undone) {\n\t\t\t\t\t\t\t\tthrow new Error('cannot undo a move multiple times');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// backout move by returning the squares to their state prior to the move\n\t\t\t\t\t\tm.prevSquare.piece = m.postSquare.piece;\n\t\t\t\t\t\tm.postSquare.piece = m.capturedPiece;\n\n\t\t\t\t\t\t// handle standard scenario\n\t\t\t\t\t\tif (!m.enPassant) {\n\t\t\t\t\t\t\tm.postSquare.piece = m.capturedPiece;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// handle en-passant scenario\n\t\t\t\t\t\tif (m.enPassant) {\n\t\t\t\t\t\t\tb.getSquare(\n\t\t\t\t\t\t\t\tm.postSquare.file,\n\t\t\t\t\t\t\t\tm.prevSquare.rank\n\t\t\t\t\t\t\t).piece = m.capturedPiece;\n\n\t\t\t\t\t\t\t// there is no piece on the post square in the event of\n\t\t\t\t\t\t\t// an en-passant, clear anything that me be present as\n\t\t\t\t\t\t\t// a result of the move (fix for issue #8)\n\t\t\t\t\t\t\tm.postSquare.piece = null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// handle castle scenario\n\t\t\t\t\t\tif (m.castle) {\n\t\t\t\t\t\t\tsq = b.getSquare(\n\t\t\t\t\t\t\t\tmove.postSquare.file === 'g' ? 'f' : 'd',\n\t\t\t\t\t\t\t\tmove.postSquare.rank);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tb.getSquare(\n\t\t\t\t\t\t\t\tmove.postSquare.file === 'g' ? 'h' : 'a',\n\t\t\t\t\t\t\t\tmove.postSquare.rank\n\t\t\t\t\t\t\t).piece = sq.piece;\n\t\t\t\t\t\t\tsq.piece = null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// if not a simulation, reset the move count\n\t\t\t\t\t\tif (!simulate) {\n\t\t\t\t\t\t\t// correct the moveCount for the piece\n\t\t\t\t\t\t\tm.prevSquare.piece.moveCount = m.prevSquare.piece.moveCount - 1;\n\n\t\t\t\t\t\t\t// indicate move has been undone\n\t\t\t\t\t\t\tm.undone = true;\n\n\t\t\t\t\t\t\t// emit an undo event\n\t\t\t\t\t\t\tb.emit('undo', m);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t};\n\n\t\t\tdest.piece = p;\n\t\t\tmove.castle = p.type === PieceType.King &&\n\t\t\t\tp.moveCount === 0 &&\n\t\t\t\t(move.postSquare.file === 'g' || move.postSquare.file === 'c');\n\t\t\tmove.enPassant = p.type === PieceType.Pawn &&\n\t\t\t\tmove.capturedPiece === null &&\n\t\t\t\tmove.postSquare.file !== move.prevSquare.file;\n\t\t\tmove.prevSquare.piece = null;\n\n\t\t\t// check for en-passant\n\t\t\tif (move.enPassant) {\n\t\t\t\tsq = this.getSquare(move.postSquare.file, move.prevSquare.rank);\n\t\t\t\tmove.capturedPiece = sq.piece;\n\t\t\t\tsq.piece = null;\n\t\t\t}\n\n\t\t\t// check for castle\n\t\t\tif (move.castle) {\n\t\t\t\tsq = this.getSquare(\n\t\t\t\t\tmove.postSquare.file === 'g' ? 'h' : 'a',\n\t\t\t\t\tmove.postSquare.rank\n\t\t\t\t);\n\n\t\t\t\tif (sq.piece === null) {\n\t\t\t\t\tmove.castle = false;\n\t\t\t\t} else {\n\t\t\t\t\tthis.getSquare(\n\t\t\t\t\t\tmove.postSquare.file === 'g' ? 'f' : 'd',\n\t\t\t\t\t\tmove.postSquare.rank\n\t\t\t\t\t).piece = sq.piece;\n\t\t\t\t\tsq.piece = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!simulate) {\n\t\t\t\tp.moveCount++;\n\t\t\t\tthis.lastMovedPiece = p;\n\n\t\t\t\tif (move.capturedPiece) {\n\t\t\t\t\tthis.emit('capture', move);\n\t\t\t\t}\n\n\t\t\t\tif (move.castle) {\n\t\t\t\t\tthis.emit('castle', move);\n\t\t\t\t}\n\n\t\t\t\tif (move.enPassant) {\n\t\t\t\t\tthis.emit('enPassant', move);\n\t\t\t\t}\n\n\t\t\t\tthis.emit('move', move);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tmove,\n\t\t\t\tundo : undo(this, move)\n\t\t\t};\n\t\t}\n\t}\n\n\tpromote (sq, p) {\n\t\t// update move count and last piece\n\t\tp.moveCount = sq.piece.moveCount;\n\t\tthis.lastMovedPiece = p;\n\n\t\t// set to square\n\t\tsq.piece = p;\n\n\t\tthis.emit('promote', sq);\n\n\t\treturn sq;\n\t}\n}\n\n// exports\nexport default { Board, NeighborType };\n"],"file":"board.js"}